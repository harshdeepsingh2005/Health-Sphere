{% extends "base.html" %}
{% load static %}

{% block title %}Staff Management — Admin Portal | HealthSphere AI{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'admin_portal:dashboard' %}" class="breadcrumb-link">Dashboard</a></li>
<li class="breadcrumb-item breadcrumb-current">Staff</li>
{% endblock %}

{% block extra_css %}
<style>
.page-header { margin-bottom: 1.5rem; }
.page-header h1 { font-size: 1.75rem; font-weight: 700; color: var(--neutral-900); margin: 0; }
.page-header p { color: var(--neutral-500); margin: .25rem 0 0; }

.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
.stat-card {
    background: white; border: 1px solid var(--neutral-100);
    border-radius: var(--radius-xl); padding: 1.25rem 1rem; text-align: center;
    box-shadow: 0 1px 5px rgba(0,0,0,.04);
}
.stat-card .val { font-size: 2rem; font-weight: 800; color: var(--neutral-900); }
.stat-card .lbl { font-size: .8125rem; color: var(--neutral-500); margin-top: .15rem; }
.stat-card.primary .val { color: var(--healthcare-primary); }
.stat-card.success .val { color: var(--healthcare-success); }
.stat-card.accent .val { color: var(--healthcare-accent); }

.filter-row { display: flex; gap: .75rem; flex-wrap: wrap; margin-bottom: 1.5rem; align-items: center; }
.filter-select { padding: .5rem .875rem; border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); background: white; color: var(--neutral-700); font-size: .875rem; }
.search-box { display: flex; align-items: center; gap: .5rem; background: white; border: 1px solid var(--neutral-200); border-radius: var(--radius-lg); padding: .5rem 1rem; flex: 1; min-width: 220px; }
.search-box input { border: none; outline: none; width: 100%; font-size: .875rem; }
.btn-filter { padding: .5rem 1rem; border-radius: var(--radius-lg); border: none; cursor: pointer; font-size: .875rem; font-weight: 500; }
.btn-apply { background: var(--healthcare-primary); color: white; }
.btn-clear { background: var(--neutral-100); color: var(--neutral-700); text-decoration: none; display: inline-flex; align-items: center; gap: .3rem; }

/* Staff card grid */
.staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 1.25rem; }
.staff-card {
    background: white; border: 1px solid var(--neutral-100);
    border-radius: var(--radius-xl); padding: 1.5rem; text-align: center;
    transition: all .2s; box-shadow: 0 1px 5px rgba(0,0,0,.04);
    position: relative; overflow: hidden;
}
.staff-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px;
    opacity: 0; transition: opacity .2s;
}
.staff-card.doctor::before { background: linear-gradient(90deg, #3b82f6, #8b5cf6); }
.staff-card.nurse::before  { background: linear-gradient(90deg, #10b981, #06b6d4); }
.staff-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,.09); }
.staff-card:hover::before { opacity: 1; }

.staff-avatar {
    width: 64px; height: 64px; border-radius: 50%; margin: 0 auto .875rem;
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 800; font-size: 1.25rem;
}
.staff-avatar.doctor { background: linear-gradient(135deg, #3b82f6, #8b5cf6); }
.staff-avatar.nurse  { background: linear-gradient(135deg, #10b981, #06b6d4); }

.staff-name { font-size: 1.0625rem; font-weight: 700; color: var(--neutral-900); }
.staff-role { font-size: .8125rem; color: var(--neutral-500); margin-top: .15rem; }
.staff-email { font-size: .8125rem; color: var(--neutral-600); margin-top: .5rem; word-break: break-all; }

.staff-card-footer {
    margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--neutral-100);
    display: flex; gap: .5rem;
}
.btn-sm {
    flex: 1; padding: .4rem .75rem; border-radius: var(--radius-md);
    font-size: .8125rem; font-weight: 500; cursor: pointer;
    text-align: center; text-decoration: none; transition: all .15s;
    display: flex; align-items: center; justify-content: center; gap: .3rem;
}
.btn-outline { border: 1px solid var(--neutral-200); background: white; color: var(--neutral-700); }
.btn-outline:hover { background: var(--neutral-50); }
.btn-primary-sm { border: none; background: var(--healthcare-primary); color: white; }
.btn-primary-sm:hover { background: var(--healthcare-primary-dark); }

.role-pill { display: inline-flex; align-items: center; gap: .3rem; padding: .2rem .6rem; border-radius: 999px; font-size: .7rem; font-weight: 700; margin-top: .5rem; }
.role-pill.doctor { background: rgba(59,130,246,.1); color: #2563eb; }
.role-pill.nurse  { background: rgba(16,185,129,.1); color: #059669; }

.empty-state { text-align: center; padding: 3rem; color: var(--neutral-500); }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-user-md" style="color: var(--healthcare-accent); margin-right: .5rem;"></i>Staff Management</h1>
    <p>View and manage all clinical staff members</p>
</div>

<!-- Stats -->
<div class="stats-row">
    <div class="stat-card primary">
        <div class="val">{{ stats.total }}</div>
        <div class="lbl">Total Staff</div>
    </div>
    <div class="stat-card accent">
        <div class="val">{{ stats.doctors }}</div>
        <div class="lbl">Doctors</div>
    </div>
    <div class="stat-card success">
        <div class="val">{{ stats.nurses }}</div>
        <div class="lbl">Nurses</div>
    </div>
    <div class="stat-card">
        <div class="val">{{ stats.on_duty_today }}</div>
        <div class="lbl">On Duty Today</div>
    </div>
</div>

<!-- Filters -->
<form method="get" class="filter-row">
    <div class="search-box">
        <i class="fas fa-search" style="color: var(--neutral-400);"></i>
        <input type="text" name="search" placeholder="Search by name or email…" value="{{ search_query }}">
    </div>
    <select name="role" class="filter-select">
        <option value="">All roles</option>
        <option value="doctor" {% if selected_role == 'doctor' %}selected{% endif %}>Doctors</option>
        <option value="nurse"  {% if selected_role == 'nurse'  %}selected{% endif %}>Nurses</option>
    </select>
    <button type="submit" class="btn-filter btn-apply"><i class="fas fa-filter"></i> Filter</button>
    <a href="{% url 'admin_portal:staff' %}" class="btn-filter btn-clear"><i class="fas fa-times"></i> Clear</a>
    <a href="{% url 'admin_portal:staff_schedule' %}" class="btn-filter btn-apply" style="background: var(--healthcare-accent);">
        <i class="fas fa-calendar-alt"></i> View Schedule
    </a>
</form>

<!-- Staff Grid -->
{% if staff %}
<div class="staff-grid">
    {% for member in staff %}
    <div class="staff-card {{ member.role.name }}">
        <div class="staff-avatar {{ member.role.name }}">
            {{ member.first_name|first|upper }}{{ member.last_name|first|upper }}
        </div>
        <div class="staff-name">{{ member.get_full_name|default:member.username }}</div>
        <div class="staff-role">{{ member.role.get_name_display }}</div>
        <div>
            <span class="role-pill {{ member.role.name }}">
                <i class="fas {% if member.role.name == 'doctor' %}fa-stethoscope{% else %}fa-procedures{% endif %}"></i>
                {{ member.role.get_name_display }}
            </span>
        </div>
        <div class="staff-email">{{ member.email }}</div>
        <div class="staff-card-footer">
            <a href="{% url 'admin_portal:staff_detail' member.id %}" class="btn-sm btn-outline">
                <i class="fas fa-eye"></i> Profile
            </a>
            <a href="{% url 'admin_portal:staff_schedule' %}" class="btn-sm btn-primary-sm">
                <i class="fas fa-calendar"></i> Schedule
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-user-md" style="font-size: 2.5rem; color: var(--neutral-300); display: block; margin-bottom: 1rem;"></i>
    <p>No staff members found matching your criteria.</p>
</div>
{% endif %}
{% endblock %}
