{% extends 'base.html' %}
{% load static %}

{% block title %}Two-Factor Authentication Setup{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-shield-alt"></i>
                        Two-Factor Authentication Setup
                    </h4>
                </div>
                <div class="card-body">
                    {% if two_factor_auth.is_enabled %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            Two-factor authentication is currently <strong>enabled</strong> for your account.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Manage 2FA</h5>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="disable">
                                    <button type="submit" class="btn btn-warning mb-3">
                                        <i class="fas fa-times"></i>
                                        Disable 2FA
                                    </button>
                                </form>
                                
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="regenerate_codes">
                                    <button type="submit" class="btn btn-secondary mb-3">
                                        <i class="fas fa-sync"></i>
                                        Generate New Backup Codes
                                    </button>
                                </form>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>Backup Codes</h5>
                                <div class="alert alert-info">
                                    <strong>Important:</strong> Save these backup codes in a safe place. 
                                    You can use them to access your account if you lose your authenticator device.
                                </div>
                                <div class="backup-codes">
                                    {% for code in backup_codes %}
                                        <code class="d-block">{{ code }}</code>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            Two-factor authentication is currently <strong>disabled</strong> for your account.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Setup Instructions</h5>
                                <ol>
                                    <li>Install an authenticator app on your phone:
                                        <ul>
                                            <li><strong>Google Authenticator</strong> (iOS/Android)</li>
                                            <li><strong>Authy</strong> (iOS/Android)</li>
                                            <li><strong>Microsoft Authenticator</strong> (iOS/Android)</li>
                                        </ul>
                                    </li>
                                    <li>Scan the QR code with your authenticator app</li>
                                    <li>Enter the 6-digit code from your app to verify setup</li>
                                </ol>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>QR Code</h5>
                                <div class="text-center mb-3">
                                    {% if two_factor_auth.qr_code %}
                                        <img src="{{ two_factor_auth.qr_code.url }}" 
                                             alt="2FA QR Code" 
                                             class="img-fluid border" 
                                             style="max-width: 200px;">
                                    {% else %}
                                        <p class="text-muted">QR Code not generated</p>
                                    {% endif %}
                                </div>
                                
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="enable">
                                    <div class="form-group">
                                        <label for="token">Enter 6-digit code:</label>
                                        <input type="text" 
                                               class="form-control" 
                                               id="token" 
                                               name="token" 
                                               maxlength="6" 
                                               pattern="[0-9]{6}" 
                                               placeholder="000000"
                                               required>
                                    </div>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-check"></i>
                                        Enable 2FA
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Security Info -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle"></i>
                        Security Information
                    </h5>
                </div>
                <div class="card-body">
                    <p><strong>What is Two-Factor Authentication?</strong></p>
                    <p>Two-factor authentication (2FA) adds an extra layer of security to your account. 
                    Even if someone knows your password, they won't be able to access your account 
                    without also having access to your phone.</p>
                    
                    <p><strong>Why should I enable 2FA?</strong></p>
                    <ul>
                        <li>Protects sensitive healthcare data</li>
                        <li>Prevents unauthorized access to patient information</li>
                        <li>Required for compliance with healthcare security standards</li>
                        <li>Helps maintain HIPAA compliance</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.backup-codes code {
    font-size: 1.1em;
    padding: 5px;
    margin: 2px 0;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
}
</style>
{% endblock %}