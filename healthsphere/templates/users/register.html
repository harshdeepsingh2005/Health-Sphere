{% extends "base_simple.html" %}
{% load static %}

{% block title %}Create Account â€” HealthSphere AI{% endblock %}

{% block extra_css %}
<style>
/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar, .header { display: none !important; }
.main-content { margin-left: 0 !important; width: 100% !important; padding: 0 !important; }
body { background: #0b0f1a; }

/* â”€â”€ Scene â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.auth-scene {
  min-height: 100vh;
  display: flex; align-items: center; justify-content: center;
  position: relative; overflow: hidden;
  font-family: 'Inter', system-ui, sans-serif;
  padding: 32px 24px;
}
.auth-scene::before, .auth-scene::after {
  content: ''; position: fixed; border-radius: 50%;
  filter: blur(90px); opacity: .4; pointer-events: none;
  animation: drift 14s ease-in-out infinite alternate;
}
.auth-scene::before {
  width: 520px; height: 520px;
  background: radial-gradient(circle, #6366f1, #3b82f6);
  top: -140px; right: -80px;
}
.auth-scene::after {
  width: 400px; height: 400px;
  background: radial-gradient(circle, #10b981, #0ea5e9);
  bottom: -100px; left: -80px;
  animation-delay: -7s;
}
@keyframes drift {
  from { transform: translate(0,0) scale(1); }
  to   { transform: translate(30px,20px) scale(1.07); }
}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.auth-card {
  position: relative; z-index: 10;
  width: 100%; max-width: 520px;
  background: rgba(15,23,42,.78);
  backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border: 1px solid rgba(255,255,255,.1);
  border-radius: 24px;
  padding: 40px;
  box-shadow: 0 32px 64px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.07);
  animation: slideUp .5s cubic-bezier(.16,1,.3,1) both;
}
@keyframes slideUp {
  from { opacity:0; transform:translateY(28px); }
  to   { opacity:1; transform:translateY(0); }
}

/* â”€â”€ Logo / header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.auth-logo-wrap {
  width: 68px; height: 68px; margin: 0 auto 18px;
  background: linear-gradient(135deg, #6366f1 0%, #10b981 100%);
  border-radius: 20px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.6rem; color: #fff;
  box-shadow: 0 8px 24px rgba(99,102,241,.4);
}
.auth-header { text-align: center; margin-bottom: 28px; }
.auth-title  { font-size: 1.75rem; font-weight: 800; color: #f8fafc; letter-spacing: -.02em; margin-bottom: 6px; }
.auth-subtitle { font-size: .875rem; color: #94a3b8; }

/* â”€â”€ Step indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.step-pills {
  display: flex; gap: 6px; justify-content: center; margin-bottom: 28px;
}
.step-pill {
  height: 4px; border-radius: 4px; flex: 1; max-width: 60px;
  background: rgba(255,255,255,.1);
  transition: background .4s;
}
.step-pill.active  { background: #3b82f6; }
.step-pill.done    { background: #10b981; }

/* â”€â”€ Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.auth-form { display: flex; flex-direction: column; gap: 16px; }
.form-row  { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (max-width: 480px) { .form-row { grid-template-columns: 1fr; } }

.form-group { display: flex; flex-direction: column; gap: 6px; }
.form-label {
  font-size: .8125rem; font-weight: 600; color: #cbd5e1;
  text-transform: uppercase; letter-spacing: .03em;
}

.form-input-wrap { position: relative; }
.input-icon {
  position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
  color: #475569; font-size: .9rem; pointer-events: none; transition: color .2s;
}
.form-input-wrap:focus-within .input-icon { color: #6366f1; }

.form-input, input[type="text"], input[type="email"], input[type="password"] {
  width: 100%; padding: 12px 14px 12px 40px;
  background: rgba(30,41,59,.7);
  border: 1px solid rgba(255,255,255,.1);
  border-radius: 12px; color: #f1f5f9;
  font-size: .9375rem; font-family: inherit;
  transition: border-color .25s, box-shadow .25s, background .25s;
  box-sizing: border-box;
}
.form-input::placeholder, input::placeholder { color: #475569; }
.form-input:focus, input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus {
  outline: none; border-color: #6366f1;
  background: rgba(30,41,59,.95);
  box-shadow: 0 0 0 3px rgba(99,102,241,.18);
}
.field-error { font-size: .8rem; color: #f87171; display: flex; align-items: center; gap: 5px; }

/* â”€â”€ Role cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
@media (max-width: 480px) { .role-grid { grid-template-columns: 1fr; } }

.role-card {
  padding: 16px; border-radius: 14px; cursor: pointer;
  border: 2px solid rgba(255,255,255,.1);
  background: rgba(30,41,59,.5);
  text-align: center; transition: all .25s;
  -webkit-user-select: none; user-select: none;
}
.role-card:hover { border-color: rgba(99,102,241,.5); background: rgba(99,102,241,.1); }
.role-card.selected { border-color: #6366f1; background: rgba(99,102,241,.15); }
.role-icon-wrap { font-size: 1.75rem; margin-bottom: 6px; }
.role-name { font-weight: 700; color: #f1f5f9; font-size: .9375rem; }
.role-desc { font-size: .75rem; color: #94a3b8; margin-top: 2px; }

/* â”€â”€ Password strength â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.strength-bar { height: 4px; border-radius: 4px; background: rgba(255,255,255,.08); margin-top: 8px; overflow: hidden; }
.strength-fill { height: 100%; border-radius: 4px; transition: width .4s, background .4s; width: 0; }
.strength-label { font-size: .75rem; color: #64748b; margin-top: 4px; }

/* â”€â”€ Checkbox â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.check-label {
  display: flex; align-items: flex-start; gap: 10px;
  font-size: .875rem; color: #94a3b8; cursor: pointer; line-height: 1.5;
}
.check-label input[type="checkbox"] { width: 16px; height: 16px; margin-top: 2px; accent-color: #6366f1; cursor: pointer; flex-shrink: 0; }
.check-label a { color: #818cf8; text-decoration: none; }
.check-label a:hover { color: #a5b4fc; }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn-primary-auth {
  width: 100%; padding: 14px;
  background: linear-gradient(135deg, #6366f1, #4f46e5);
  color: #fff; border: none; border-radius: 12px;
  font-size: 1rem; font-weight: 700; font-family: inherit;
  cursor: pointer; transition: all .25s; letter-spacing: .01em;
}
.btn-primary-auth:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(99,102,241,.45); }
.btn-primary-auth:active { transform: translateY(0); }

.btn-ghost-auth {
  width: 100%; padding: 13px;
  background: rgba(255,255,255,.05);
  color: #cbd5e1; border: 1px solid rgba(255,255,255,.1);
  border-radius: 12px; font-size: .9375rem; font-weight: 600;
  font-family: inherit; cursor: pointer; text-decoration: none;
  text-align: center; display: block; transition: all .25s;
}
.btn-ghost-auth:hover { background: rgba(255,255,255,.1); color: #f1f5f9; }

.auth-divider { display: flex; align-items: center; gap: 12px; color: #475569; font-size: .8125rem; }
.auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,.08); }

/* â”€â”€ Alerts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.alert-box { padding: 12px 14px; border-radius: 10px; font-size: .875rem; display: flex; align-items: flex-start; gap: 10px; margin-bottom: 4px; }
.alert-box.error   { background: rgba(239,68,68,.12);  border: 1px solid rgba(239,68,68,.25);  color: #fca5a5; }
.alert-box.success { background: rgba(16,185,129,.12); border: 1px solid rgba(16,185,129,.25); color: #6ee7b7; }

/* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.auth-footer { text-align: center; margin-top: 20px; font-size: .8125rem; color: #475569; }
.security-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 12px;
  background: rgba(16,185,129,.1); border: 1px solid rgba(16,185,129,.2);
  border-radius: 20px; color: #34d399; font-size: .75rem; font-weight: 600;
  margin-top: 14px;
}
</style>
{% endblock %}

{% block content %}
<div class="auth-scene">
  <div class="auth-card">
    <!-- Header -->
    <div class="auth-header">
      <div class="auth-logo-wrap">
        <i class="fas fa-user-plus"></i>
      </div>
      <h1 class="auth-title">Join HealthSphere AI</h1>
      <p class="auth-subtitle">Create your healthcare account in seconds</p>
    </div>

    <!-- Step pills -->
    <div class="step-pills">
      <div class="step-pill active" id="pill-0"></div>
      <div class="step-pill" id="pill-1"></div>
      <div class="step-pill" id="pill-2"></div>
    </div>

    <!-- Alerts -->
    {% if messages %}
      {% for message in messages %}
      <div class="alert-box {% if message.tags == 'error' %}error{% else %}success{% endif %}">
        <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% else %}check-circle{% endif %}"></i>
        <span>{{ message }}</span>
      </div>
      {% endfor %}
    {% endif %}

    <form method="post" class="auth-form" id="reg-form">
      {% csrf_token %}

      <!-- Step 0 â€“ Role -->
      <div class="form-step" id="step-0">
        <div class="form-group">
          <label class="form-label">I am a</label>
          <div class="role-grid">
            <div class="role-card selected" data-role="patient" id="role-patient">
              <div class="role-icon-wrap">ğŸ‘¤</div>
              <div class="role-name">Patient</div>
              <div class="role-desc">Manage my health &amp; records</div>
            </div>
            <div class="role-card" data-role="doctor" id="role-doctor">
              <div class="role-icon-wrap">ğŸ‘©â€âš•ï¸</div>
              <div class="role-name">Doctor</div>
              <div class="role-desc">Provide clinical care</div>
            </div>
            <div class="role-card" data-role="nurse" id="role-nurse">
              <div class="role-icon-wrap">ğŸ’Š</div>
              <div class="role-name">Nurse</div>
              <div class="role-desc">Patient support &amp; monitoring</div>
            </div>
            <div class="role-card" data-role="admin" id="role-admin">
              <div class="role-icon-wrap">ğŸ¥</div>
              <div class="role-name">Admin</div>
              <div class="role-desc">Hospital management</div>
            </div>
          </div>
          <input type="hidden" name="role" id="role-input" value="patient">
        </div>
        <button type="button" class="btn-primary-auth" style="margin-top:8px;" onclick="nextStep(1)">
          Continue <i class="fas fa-arrow-right"></i>
        </button>
      </div>

      <!-- Step 1 â€“ Personal info -->
      <div class="form-step" id="step-1" style="display:none; flex-direction:column; gap:16px;">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="{{ form.first_name.id_for_label }}">First Name</label>
            <div class="form-input-wrap">
              <i class="fas fa-user input-icon"></i>
              {{ form.first_name }}
            </div>
            {% if form.first_name.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.first_name.errors.0 }}</span>{% endif %}
          </div>
          <div class="form-group">
            <label class="form-label" for="{{ form.last_name.id_for_label }}">Last Name</label>
            <div class="form-input-wrap">
              <i class="fas fa-user input-icon"></i>
              {{ form.last_name }}
            </div>
            {% if form.last_name.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.last_name.errors.0 }}</span>{% endif %}
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="{{ form.email.id_for_label }}">Email Address</label>
          <div class="form-input-wrap">
            <i class="fas fa-envelope input-icon"></i>
            {{ form.email }}
          </div>
          {% if form.email.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.email.errors.0 }}</span>{% endif %}
        </div>
        <div class="form-group">
          <label class="form-label" for="{{ form.username.id_for_label }}">Username</label>
          <div class="form-input-wrap">
            <i class="fas fa-at input-icon"></i>
            {{ form.username }}
          </div>
          {% if form.username.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.username.errors.0 }}</span>{% endif %}
        </div>
        <div style="display:flex; gap:10px;">
          <button type="button" class="btn-ghost-auth" style="width:auto; padding:12px 20px;" onclick="nextStep(0)">
            <i class="fas fa-arrow-left"></i>
          </button>
          <button type="button" class="btn-primary-auth" onclick="nextStep(2)">
            Continue <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Step 2 â€“ Password & terms -->
      <div class="form-step" id="step-2" style="display:none; flex-direction:column; gap:16px;">
        <div class="form-group">
          <label class="form-label" for="{{ form.password1.id_for_label }}">Password</label>
          <div class="form-input-wrap">
            <i class="fas fa-lock input-icon"></i>
            {{ form.password1 }}
          </div>
          <div class="strength-bar"><div class="strength-fill" id="strength-fill"></div></div>
          <div class="strength-label" id="strength-label"></div>
          {% if form.password1.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.password1.errors.0 }}</span>{% endif %}
        </div>
        <div class="form-group">
          <label class="form-label" for="{{ form.password2.id_for_label }}">Confirm Password</label>
          <div class="form-input-wrap">
            <i class="fas fa-lock input-icon"></i>
            {{ form.password2 }}
          </div>
          {% if form.password2.errors %}<span class="field-error"><i class="fas fa-exclamation-circle"></i>{{ form.password2.errors.0 }}</span>{% endif %}
        </div>
        <label class="check-label">
          <input type="checkbox" id="terms" name="terms">
          I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
        </label>
        <div style="display:flex; gap:10px;">
          <button type="button" class="btn-ghost-auth" style="width:auto; padding:12px 20px;" onclick="nextStep(1)">
            <i class="fas fa-arrow-left"></i>
          </button>
          <button type="submit" class="btn-primary-auth" id="submit-btn">
            <i class="fas fa-user-check"></i>&nbsp; Create Account
          </button>
        </div>
      </div>

      <div class="auth-divider" style="margin-top:4px;">or</div>
      <a href="{% url 'users:login' %}" class="btn-ghost-auth">Already have an account? Sign In</a>

    </form>

    <div class="auth-footer">
      <div class="security-badge">
        <i class="fas fa-shield-alt"></i> Secure registration Â· End-to-end encrypted
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {

  // Style Django inputs
  document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]').forEach(el => {
    el.classList.add('form-input');
    el.style.paddingLeft = '40px';
  });

  // Role selection
  document.querySelectorAll('.role-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      document.getElementById('role-input').value = card.dataset.role;
    });
  });

  // Password strength
  const p1 = document.querySelector('input[name="password1"]');
  if (p1) {
    p1.addEventListener('input', () => {
      const val = p1.value;
      let score = 0;
      if (val.length >= 8)  score++;
      if (/[A-Z]/.test(val)) score++;
      if (/[0-9]/.test(val)) score++;
      if (/[^A-Za-z0-9]/.test(val)) score++;
      const colors = ['#ef4444','#f97316','#eab308','#10b981'];
      const labels = ['Weak','Fair','Good','Strong'];
      const fill = document.getElementById('strength-fill');
      const lbl  = document.getElementById('strength-label');
      fill.style.width = (score * 25) + '%';
      fill.style.background = colors[score-1] || '#475569';
      lbl.textContent = score > 0 ? labels[score-1] : '';
    });
  }
});

// â”€â”€ Step navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentStep = 0;

function showStep(n) {
  document.querySelectorAll('.form-step').forEach((el, i) => {
    el.style.display = i === n ? 'flex' : 'none';
  });
  document.querySelectorAll('.step-pill').forEach((p, i) => {
    p.classList.remove('active','done');
    if (i < n)  p.classList.add('done');
    if (i === n) p.classList.add('active');
  });
  currentStep = n;
}
function nextStep(n) { showStep(n); }

// If Django returned errors, jump to the right step
{% if form.errors %}
  {% if form.first_name.errors or form.last_name.errors or form.email.errors or form.username.errors %}
  showStep(1);
  {% elif form.password1.errors or form.password2.errors %}
  showStep(2);
  {% else %}
  showStep(2);
  {% endif %}
{% endif %}

// Submit: validate terms then show loading
document.getElementById('reg-form').addEventListener('submit', function (e) {
  const terms = document.getElementById('terms');
  if (!terms.checked) {
    e.preventDefault();
    terms.closest('.check-label').style.outline = '2px solid #ef4444';
    terms.closest('.check-label').style.borderRadius = '6px';
    showStep(2);
    return;
  }
  const btn = document.getElementById('submit-btn');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>&nbsp; Creatingâ€¦';
  btn.disabled = true;
});
</script>
{% endblock %}
