{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/bento-grid.css' %}">
<style>
/* Small tweaks for triage cards using theme variables */
.triage-patient-card { padding: 14px; border-radius: var(--radius-lg); background: var(--color-card); box-shadow: var(--card-shadow); color: var(--text-primary); border: 1px solid var(--card-border); }
.triage-badge { padding: 6px 10px; border-radius: var(--radius-base); font-weight: 700; font-size: 12px; display:inline-block; }
.triage-critical { background: rgba(239,68,68,0.08); color: var(--error); }
.triage-urgent { background: rgba(245,158,11,0.06); color: var(--warning); }
.triage-standard { background: rgba(16,185,129,0.06); color: var(--success); }
/* Theme wrapper */
.triage-theme { 
    padding: 28px 32px; 
    background: var(--color-bg);
    min-height: calc(100vh - var(--navbar-height));
}
.triage-theme .bento-card { background: var(--color-card); border-radius: var(--radius-2xl); box-shadow: var(--glass-shadow-md); border: 1px solid var(--card-border); }
.triage-theme .card-title { color: var(--text-primary); font-weight:700; display:flex; gap:12px; align-items:center; }
.triage-theme .metric-value { font-size: 40px; font-weight:700; color:var(--text-primary); }
.triage-theme .metric-label { color:var(--text-secondary); }
.triage-theme .metric-icon { width:56px; height:56px; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#fff; }
.gradient-risk { background: linear-gradient(135deg,var(--color-secondary), #6ee7b7); }
.gradient-high { background: linear-gradient(135deg,var(--info), var(--color-primary)); }
.gradient-medium { background: linear-gradient(135deg,var(--warning), #fcd34d); }
.triage-theme .bento-btn { background: linear-gradient(90deg,var(--color-primary), var(--info)); color: var(--color-card); border:none; padding:8px 12px; border-radius:8px; box-shadow: 0 6px 18px rgba(37,99,235,0.12); }
.triage-theme .bento-btn:hover { transform:translateY(-1px); }
</style>
{% endblock %}

{% block content %}
<div class="triage-theme">
    <div class="bento-grid">
    <div class="bento-card bento-featured" data-tilt>
        <div class="card-glow"></div>
        <div class="card-header">
            <div class="card-title">
                <div class="metric-icon gradient-risk"><i class="fas fa-procedures"></i></div>
                AI Triage Dashboard
            </div>
            <div class="card-actions">
                <button class="bento-btn">Refresh</button>
            </div>
        </div>
        <p class="muted">Emergency triage prioritization and AI recommendations.</p>
    </div>

        <div class="bento-card bento-small interactive">
        <div class="card-glow"></div>
        <div class="metric-icon gradient-high"><i class="fas fa-procedural"></i></div>
        <div class="metric-value">{{ stats.total_emergency }}</div>
        <div class="metric-label">Total Emergency</div>
    </div>

    <div class="bento-card bento-small interactive">
        <div class="card-glow"></div>
        <div class="metric-icon gradient-high"><i class="fas fa-skull-crossbones"></i></div>
        <div class="metric-value">{{ stats.critical }}</div>
        <div class="metric-label">Critical</div>
    </div>

    <div class="bento-card bento-small interactive">
        <div class="card-glow"></div>
        <div class="metric-icon gradient-medium"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="metric-value">{{ stats.urgent }}</div>
        <div class="metric-label">Urgent</div>
    </div>

        <div class="bento-card bento-featured">
        <div class="card-glow"></div>
        <div class="card-header">
            <div class="card-title"><i class="fas fa-users"></i> Patient Queue</div>
        </div>
        <div class="triage-queue" style="margin-top:12px; display:grid; gap:10px;">
            {% for item in triage_queue %}
            <div class="triage-patient-card">
                <div class="triage-row" style="display:flex; justify-content:space-between; align-items:flex-start">
                    <div>
                        <div style="font-weight:700">{{ item.patient.get_full_name|default:item.patient.username }}</div>
                        <div style="color:var(--text-secondary); font-size:13px; margin-top:4px;">ID: {{ item.patient.id }} â€¢ {{ item.admission.admission_type|capfirst }}</div>
                    </div>
                    <div style="text-align:right">
                        <div class="triage-badge {% if item.triage_level == 'Critical' %}triage-critical{% elif item.triage_level == 'Urgent' %}triage-urgent{% else %}triage-standard{% endif %}">{{ item.triage_level }}</div>
                        <div style="font-weight:700; margin-top:8px">Score: {{ item.triage_score }}</div>
                    </div>
                </div>
                <div style="margin-top:8px; color:var(--text-secondary)">{{ item.recommendation }}</div>
            </div>
            {% empty %}
            <div class="triage-patient-card">No patients in the triage queue.</div>
            {% endfor %}
        </div>
    </div>

    <div class="bento-card bento-tall">
        <div class="card-glow"></div>
        <div class="card-title"><i class="fas fa-lightbulb"></i> AI Recommendations</div>
        <div style="margin-top:12px">
            {% for item in triage_queue %}
                <div style="padding:8px; border-bottom:1px solid #EDF2F7">{{ item.recommendation }}</div>
            {% empty %}
                <div style="padding:8px; color:#718096">No recommendations available.</div>
            {% endfor %}
        </div>
    </div>
    </div>
</div>
{% endblock %}
