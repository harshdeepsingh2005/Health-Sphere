{% extends "base_simple.html" %}
{% load static %}

{% block title %}Clinical Dashboard - HealthSphere AI{% endblock %}

{% block sidebar_nav %}
<!-- Clinical Navigation -->
<div class="nav-section">
    <div class="nav-section-title">Clinical</div>
    <div class="nav-item">
        <a href="{% url 'clinical_portal:dashboard' %}" class="nav-link active">
            <i class="fas fa-th-large"></i>
            <span class="nav-link-text">Dashboard</span>
        </a>
    </div>
    <div class="nav-item">
        <a href="{% url 'clinical_portal:triage' %}" class="nav-link">
            <i class="fas fa-stethoscope"></i>
            <span class="nav-link-text">AI Triage</span>
        </a>
    </div>
    <div class="nav-item">
        <a href="{% url 'clinical_portal:risk' %}" class="nav-link">
            <i class="fas fa-exclamation-triangle"></i>
            <span class="nav-link-text">Risk Assessment</span>
        </a>
    </div>
    <div class="nav-item">
        <a href="{% url 'clinical_portal:journey' %}" class="nav-link">
            <i class="fas fa-route"></i>
            <span class="nav-link-text">Patient Journey</span>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* ===== BENTO GRID LAYOUT ===== */
.bento-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    padding: 24px;
    max-width: 1600px;
    margin: 0 auto;
}

.bento-small { grid-column: span 1; grid-row: span 1; }
.bento-wide { grid-column: span 2; grid-row: span 1; }
.bento-tall { grid-column: span 1; grid-row: span 2; }
.bento-large { grid-column: span 2; grid-row: span 1; }
.bento-featured { grid-column: span 2; grid-row: span 2; }

/* ===== INTERACTIVE CARDS ===== */
.bento-card {
    background: white;
    border-radius: 20px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    cursor: pointer;
}

.bento-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.15);
}

[data-hover-lift]:hover {
    transform: translateY(-8px) scale(1.02);
}

[data-tilt]:hover {
    transform: perspective(1000px) rotateX(2deg) rotateY(-2deg) scale(1.01);
}

.card-glow {
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(232, 155, 135, 0.15) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
}

.bento-card:hover .card-glow {
    opacity: 1;
}

/* ===== GREETING ===== */
.greeting-content h1 {
    font-size: 32px;
    font-weight: 700;
    color: #2D3748;
    margin-bottom: 8px;
}

.greeting-subtitle {
    font-size: 16px;
    color: #718096;
    margin-bottom: 20px;
}

.doctor-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(168, 197, 232, 0.1);
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 14px;
    color: var(--color-blue);
    font-weight: 600;
}

/* ===== METRICS ===== */
.card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
}

.metric-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
    transition: transform 0.3s ease;
}

.bento-card:hover .metric-icon {
    transform: scale(1.1) rotate(5deg);
}

.pulse-icon {
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.metric-value {
    font-size: 48px;
    font-weight: 700;
    color: #2D3748;
    line-height: 1;
    margin-bottom: 8px;
}

.metric-label {
    font-size: 14px;
    color: #718096;
    font-weight: 500;
    margin-bottom: 16px;
}

.metric-trend {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 13px;
    font-weight: 500;
    color: #48bb78;
}

.card-badge {
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    background: rgba(232, 155, 135, 0.15);
    color: var(--color-coral);
}

.card-badge.urgent {
    animation: pulseAlert 2s ease-in-out infinite;
}

@keyframes pulseAlert {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* ===== PATIENT LIST ===== */
.patient-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 400px;
    overflow-y: auto;
}

.patient-item {
    padding: 14px;
    background: rgba(168, 197, 232, 0.03);
    border-radius: 12px;
    border-left: 4px solid var(--color-blue);
    transition: all 0.3s ease;
}

.patient-item:hover {
    background: rgba(168, 197, 232, 0.08);
    transform: translateX(4px);
}

.patient-item.critical {
    border-left-color: var(--color-coral);
    background: rgba(232, 155, 135, 0.05);
}

.patient-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.patient-name {
    font-size: 15px;
    font-weight: 600;
    color: #2D3748;
}

.patient-status {
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    background: rgba(72, 187, 120, 0.1);
    color: #48bb78;
}

.patient-status.critical {
    background: rgba(232, 155, 135, 0.15);
    color: var(--color-coral);
}

.patient-details {
    font-size: 13px;
    color: #718096;
}

/* ===== APPOINTMENTS ===== */
.appointment-timeline {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.timeline-item {
    display: flex;
    gap: 16px;
}

.timeline-time {
    min-width: 80px;
    font-size: 14px;
    font-weight: 600;
    color: var(--color-blue);
}

.timeline-content {
    flex: 1;
    padding: 14px;
    background: rgba(168, 197, 232, 0.05);
    border-radius: 10px;
    border-left: 3px solid var(--color-blue);
}

.timeline-patient {
    font-size: 14px;
    font-weight: 600;
    color: #2D3748;
    margin-bottom: 4px;
}

.timeline-type {
    font-size: 13px;
    color: #718096;
}

/* ===== ALERTS ===== */
.alert-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.alert-item {
    padding: 16px;
    background: rgba(232, 155, 135, 0.05);
    border-radius: 12px;
    border-left: 4px solid var(--color-coral);
}

.alert-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 8px;
}

.alert-title {
    font-size: 14px;
    font-weight: 600;
    color: #2D3748;
}

.alert-priority {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    background: rgba(232, 155, 135, 0.15);
    color: var(--color-coral);
}

.alert-message {
    font-size: 13px;
    color: #718096;
    margin-bottom: 8px;
}

.alert-time {
    font-size: 12px;
    color: #A0AEC0;
}

/* ===== QUICK STATS ===== */
.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.stat-item {
    text-align: center;
    padding: 16px;
    background: linear-gradient(135deg, rgba(168, 197, 232, 0.05) 0%, rgba(168, 197, 232, 0.02) 100%);
    border-radius: 12px;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #2D3748;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 12px;
    color: #718096;
}

/* ===== ACTION BUTTON ===== */
.card-action-btn {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--color-blue), #b8d4f0);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 16px;
}

.card-action-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(168, 197, 232, 0.4);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1400px) {
    .bento-grid { grid-template-columns: repeat(3, 1fr); }
    .bento-featured { grid-column: span 3; }
}

@media (max-width: 1024px) {
    .bento-grid { grid-template-columns: repeat(2, 1fr); }
    .bento-wide, .bento-large, .bento-featured { grid-column: span 2; }
}

@media (max-width: 768px) {
    .bento-grid { grid-template-columns: 1fr; }
    .bento-small, .bento-wide, .bento-large, .bento-tall, .bento-featured {
        grid-column: span 1;
        grid-row: span 1;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="bento-grid">
    <!-- Greeting Card (2x1) -->
    <div class="bento-card bento-large" data-tilt>
        <div class="card-glow"></div>
        <div class="greeting-content">
            <h1>Welcome, Dr. {{ user.last_name|default:user.username }}</h1>
            <p class="greeting-subtitle">Here's your clinical overview for today</p>
            <div class="doctor-badge">
                <i class="fas fa-user-md"></i>
                <span>{{ active_plans|length }} active care plans</span>
            </div>
        </div>
    </div>

    <!-- Active Patients (1x1) -->
    <div class="bento-card bento-small" data-hover-lift>
        <div class="card-header">
            <div class="metric-icon" style="background: linear-gradient(135deg, #A8C5E8, #b8d4f0);">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="metric-value">{{ my_patients|length|default:"24" }}</div>
        <div class="metric-label">My Patients</div>
        <div class="metric-trend">
            <i class="fas fa-arrow-up"></i>
            2 new this week
        </div>
    </div>

    <!-- Critical Alerts (1x1) -->
    <div class="bento-card bento-small" data-hover-lift>
        <div class="card-header">
            <div class="metric-icon pulse-icon" style="background: linear-gradient(135deg, #E89B87, #f4a690);">
                <i class="fas fa-bell"></i>
            </div>
            <span class="card-badge urgent">Urgent</span>
        </div>
        <div class="metric-value">{{ critical_alerts|length|default:"5" }}</div>
        <div class="metric-label">Critical Alerts</div>
        <div class="metric-trend" style="color: var(--color-coral);">
            <i class="fas fa-exclamation-circle"></i>
            Requires attention
        </div>
    </div>

    <!-- Today's Appointments (2x1) -->
    <div class="bento-card bento-wide" data-tilt>
        <h3 style="font-size: 18px; font-weight: 700; color: #2D3748; margin-bottom: 20px;">
            <i class="fas fa-calendar-day" style="color: var(--color-peach); margin-right: 8px;"></i>
            Today's Schedule
        </h3>
        <div class="appointment-timeline">
            <div class="timeline-item">
                <div class="timeline-time">9:00 AM</div>
                <div class="timeline-content">
                    <div class="timeline-patient">Sarah Johnson</div>
                    <div class="timeline-type">Annual Checkup</div>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">10:30 AM</div>
                <div class="timeline-content">
                    <div class="timeline-patient">Michael Brown</div>
                    <div class="timeline-type">Follow-up - Hypertension</div>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-time">2:00 PM</div>
                <div class="timeline-content">
                    <div class="timeline-patient">Emily Davis</div>
                    <div class="timeline-type">Lab Review</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Critical Patients (1x2 tall) -->
    <div class="bento-card bento-tall" data-hover-lift>
        <h3 style="font-size: 18px; font-weight: 700; color: #2D3748; margin-bottom: 20px;">
            <i class="fas fa-exclamation-triangle" style="color: var(--color-coral); margin-right: 8px;"></i>
            Critical Patients
        </h3>
        <div class="patient-list">
            {% for patient in high_risk_patients %}
            <div class="patient-item critical">
                <div class="patient-header">
                    <span class="patient-name">{{ patient.user.get_full_name }}</span>
                    <span class="patient-status critical">Critical</span>
                </div>
                <div class="patient-details">Risk Score: {{ patient.risk_level }} • Last visit: {{ patient.last_visit|date:"M d" }}</div>
            </div>
            {% empty %}
            <div class="patient-item critical">
                <div class="patient-header">
                    <span class="patient-name">Robert Anderson</span>
                    <span class="patient-status critical">Critical</span>
                </div>
                <div class="patient-details">Cardiac episode • BP: 185/110</div>
            </div>
            <div class="patient-item critical">
                <div class="patient-header">
                    <span class="patient-name">Maria Garcia</span>
                    <span class="patient-status critical">Critical</span>
                </div>
                <div class="patient-details">Diabetic crisis • Glucose: 350</div>
            </div>
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">John Smith</span>
                    <span class="patient-status" style="background: rgba(237, 137, 54, 0.1); color: #ed8936;">Monitoring</span>
                </div>
                <div class="patient-details">Post-surgery • Day 3 recovery</div>
            </div>
            {% endfor %}
        </div>
        <button class="card-action-btn" onclick="window.location.href='{% url 'clinical_portal:risk' %}'">
            View All Patients <i class="fas fa-arrow-right"></i>
        </button>
    </div>

    <!-- My Patients (2x2 featured) -->
    <div class="bento-card bento-featured" data-tilt>
        <h3 style="font-size: 20px; font-weight: 700; color: #2D3748; margin-bottom: 24px;">
            <i class="fas fa-users-medical" style="color: var(--color-blue); margin-right: 8px;"></i>
            My Patient Panel
        </h3>
        <div class="patient-list">
            {% for patient in my_patients %}
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">{{ patient.user.get_full_name }}</span>
                    <span class="patient-status">{{ patient.status|default:"Stable" }}</span>
                </div>
                <div class="patient-details">
                    {% if patient.conditions %}
                        {{ patient.conditions|slice:":50" }}
                    {% else %}
                        Regular care • Next visit scheduled
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">Sarah Miller</span>
                    <span class="patient-status">Stable</span>
                </div>
                <div class="patient-details">Diabetes Type 2 • Last HbA1c: 6.5%</div>
            </div>
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">James Wilson</span>
                    <span class="patient-status">Stable</span>
                </div>
                <div class="patient-details">Hypertension • BP: 130/85 mmHg</div>
            </div>
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">Lisa Anderson</span>
                    <span class="patient-status" style="background: rgba(72, 187, 120, 0.1); color: #48bb78;">Improving</span>
                </div>
                <div class="patient-details">Post-MI recovery • Week 4 cardiac rehab</div>
            </div>
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">David Chen</span>
                    <span class="patient-status">Stable</span>
                </div>
                <div class="patient-details">COPD management • SpO2: 94%</div>
            </div>
            <div class="patient-item">
                <div class="patient-header">
                    <span class="patient-name">Emma Thompson</span>
                    <span class="patient-status">Stable</span>
                </div>
                <div class="patient-details">Asthma • No recent exacerbations</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Pending Reviews (1x1) -->
    <div class="bento-card bento-small" data-hover-lift>
        <div class="card-header">
            <div class="metric-icon" style="background: linear-gradient(135deg, #F0C3A0, #f5d4b8);">
                <i class="fas fa-clipboard-list"></i>
            </div>
        </div>
        <div class="metric-value">{{ recent_records|length|default:"12" }}</div>
        <div class="metric-label">Pending Reviews</div>
        <div class="metric-trend" style="color: #ed8936;">
            <i class="fas fa-clock"></i>
            3 high priority
        </div>
    </div>

    <!-- Quick Stats (1x1) -->
    <div class="bento-card bento-small" data-hover-lift>
        <h3 style="font-size: 16px; font-weight: 700; color: #2D3748; margin-bottom: 16px;">Quick Stats</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ recent_vitals|length|default:"45" }}</div>
                <div class="stat-label">Vitals Today</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ todays_appointments_list|length|default:"18" }}</div>
                <div class="stat-label">Appointments</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">8</div>
                <div class="stat-label">Lab Results</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">3</div>
                <div class="stat-label">Referrals</div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add tilt effect
    document.querySelectorAll('[data-tilt]').forEach(card => {
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const rotateX = (y - centerY) / 20;
            const rotateY = (centerX - x) / 20;
            
            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.01)`;
        });
        
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
        });
    });
});
</script>
{% endblock %}
