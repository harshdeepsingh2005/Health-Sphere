{% comment %}
Sidebar Navigation Item Component - HealthSphere AI
=================================================

Usage Examples:
{% include 'components/nav_item.html' with icon="fas fa-home" label="Dashboard" url="/dashboard/" active=True %}
{% include 'components/nav_item.html' with icon="fas fa-users" label="Patients" url="/patients/" badge="12" %}
{% include 'components/nav_item.html' with icon="fas fa-calendar" label="Appointments" url="/appointments/" tooltip="Manage appointments" %}
{% include 'components/nav_item.html' with icon="fas fa-chart-line" label="Analytics" url="/analytics/" disabled=True %}

Parameters:
- icon: Font Awesome icon class (required)
- label: Navigation item text (required)
- url: Link destination (optional, defaults to #)
- active: Boolean for active state (default: False)
- badge: Badge text/number (optional)
- badge_type: "count", "dot", "status" (default: count)
- badge_variant: "primary", "success", "warning", "danger" (default: primary)
- tooltip: Tooltip text (optional)
- disabled: Boolean for disabled state (default: False)
- size: "sm", "md", "lg" (default: md)
- variant: "default", "minimal", "pill" (default: default)
- target: Link target attribute (optional)
- onclick: JavaScript onclick handler (optional)
- submenu: List of submenu items (optional)
- expanded: Boolean for expanded submenu state (default: False)

Submenu item structure:
submenu: [
    {icon: "fas fa-user-plus", label: "Add Patient", url: "/patients/add/"},
    {icon: "fas fa-list", label: "Patient List", url: "/patients/", active: True}
]

{% endcomment %}

{% load static %}

<!-- Navigation Item Container -->
<div class="healthcare-nav-item-container healthcare-nav-item-{{ size|default:'md' }} healthcare-nav-item-{{ variant|default:'default' }}{% if active %} healthcare-nav-item-active{% endif %}{% if disabled %} healthcare-nav-item-disabled{% endif %}{% if submenu %} healthcare-nav-item-has-submenu{% if expanded %} healthcare-nav-item-expanded{% endif %}{% endif %}"
     {% if tooltip %}data-tooltip="{{ tooltip }}"{% endif %}
     data-nav-item="{{ label|slugify }}">
    
    <!-- Main Navigation Link -->
    {% if not disabled %}
    <a href="{{ url|default:'#' }}" 
       class="healthcare-nav-item"
       {% if target %}target="{{ target }}"{% endif %}
       {% if onclick %}onclick="{{ onclick }}"{% endif %}
       {% if submenu %}data-toggle-submenu{% endif %}
       aria-label="{{ label }}{% if badge %} ({{ badge }}){% endif %}"
       {% if active %}aria-current="page"{% endif %}>
    {% else %}
    <div class="healthcare-nav-item healthcare-nav-item-link-disabled"
         aria-label="{{ label }} (disabled)"
         aria-disabled="true">
    {% endif %}
        
        <!-- Icon -->
        <div class="healthcare-nav-item-icon">
            <i class="{{ icon }}" aria-hidden="true"></i>
        </div>
        
        <!-- Label -->
        <div class="healthcare-nav-item-label">
            <span class="healthcare-nav-item-text">{{ label }}</span>
            
            <!-- Badge -->
            {% if badge %}
            <div class="healthcare-nav-item-badge healthcare-nav-item-badge-{{ badge_type|default:'count' }} healthcare-nav-item-badge-{{ badge_variant|default:'primary' }}">
                {% if badge_type == 'dot' %}
                <span class="healthcare-nav-item-badge-dot"></span>
                {% else %}
                <span class="healthcare-nav-item-badge-text">{{ badge }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- Submenu Arrow -->
        {% if submenu %}
        <div class="healthcare-nav-item-arrow">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </div>
        {% endif %}
        
        <!-- Active Indicator -->
        {% if active %}
        <div class="healthcare-nav-item-indicator" aria-hidden="true"></div>
        {% endif %}
    
    {% if not disabled %}
    </a>
    {% else %}
    </div>
    {% endif %}
    
    <!-- Submenu -->
    {% if submenu %}
    <div class="healthcare-nav-submenu" 
         aria-label="{{ label }} submenu"
         {% if not expanded %}style="display: none;"{% endif %}>
        {% for item in submenu %}
        <a href="{{ item.url|default:'#' }}" 
           class="healthcare-nav-submenu-item{% if item.active %} healthcare-nav-submenu-item-active{% endif %}"
           {% if item.target %}target="{{ item.target }}"{% endif %}
           {% if item.onclick %}onclick="{{ item.onclick }}"{% endif %}
           aria-label="{{ item.label }}"
           {% if item.active %}aria-current="page"{% endif %}>
            
            {% if item.icon %}
            <div class="healthcare-nav-submenu-icon">
                <i class="{{ item.icon }}" aria-hidden="true"></i>
            </div>
            {% endif %}
            
            <span class="healthcare-nav-submenu-text">{{ item.label }}</span>
            
            {% if item.badge %}
            <div class="healthcare-nav-item-badge healthcare-nav-item-badge-sm healthcare-nav-item-badge-{{ item.badge_variant|default:'primary' }}">
                <span class="healthcare-nav-item-badge-text">{{ item.badge }}</span>
            </div>
            {% endif %}
        </a>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Tooltip -->
    {% if tooltip %}
    <div class="healthcare-nav-item-tooltip" role="tooltip">
        {{ tooltip }}
        <div class="healthcare-nav-item-tooltip-arrow"></div>
    </div>
    {% endif %}
</div>

<style>
/* =============================================
   Healthcare Navigation Item Component Styles
   ============================================= */

/* Container */
.healthcare-nav-item-container {
    position: relative;
    margin: var(--spacing-1, 4px) 0;
}

/* Navigation Item Base */
.healthcare-nav-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-3, 12px);
    padding: var(--spacing-3, 12px);
    border-radius: var(--radius-xl, 16px);
    text-decoration: none;
    color: var(--text-secondary, #6b7280);
    background: transparent;
    border: 1px solid transparent;
    transition: all var(--transition-base, 0.3s ease);
    position: relative;
    overflow: hidden;
    font-family: var(--font-sans, 'Inter', system-ui, sans-serif);
    cursor: pointer;
    min-height: 44px; /* Touch target size */
}

.healthcare-nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--glass-bg, rgba(255, 255, 255, 0.05));
    backdrop-filter: var(--glass-blur, blur(20px));
    border-radius: inherit;
    opacity: 0;
    transition: all var(--transition-base, 0.3s ease);
    z-index: -1;
}

.healthcare-nav-item:hover::before {
    opacity: 1;
    background: var(--glass-bg-hover, rgba(255, 255, 255, 0.1));
}

.healthcare-nav-item:hover {
    color: var(--text-primary, #1f2937);
    border-color: var(--glass-border, rgba(255, 255, 255, 0.2));
    box-shadow: var(--glass-shadow-lg, 0 10px 32px rgba(0, 0, 0, 0.1));
    transform: translateX(4px);
}

/* Sizes */
.healthcare-nav-item-sm .healthcare-nav-item {
    padding: var(--spacing-2, 8px);
    gap: var(--spacing-2, 8px);
    min-height: 36px;
}

.healthcare-nav-item-md .healthcare-nav-item {
    padding: var(--spacing-3, 12px);
    gap: var(--spacing-3, 12px);
    min-height: 44px;
}

.healthcare-nav-item-lg .healthcare-nav-item {
    padding: var(--spacing-4, 16px);
    gap: var(--spacing-4, 16px);
    min-height: 52px;
}

/* Variants */
.healthcare-nav-item-minimal .healthcare-nav-item {
    border-radius: var(--radius-lg, 12px);
    padding: var(--spacing-2, 8px) var(--spacing-3, 12px);
}

.healthcare-nav-item-pill .healthcare-nav-item {
    border-radius: var(--radius-full, 9999px);
    padding: var(--spacing-2, 8px) var(--spacing-4, 16px);
}

/* Icon */
.healthcare-nav-item-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
    transition: all var(--transition-base, 0.3s ease);
}

.healthcare-nav-item-sm .healthcare-nav-item-icon {
    width: 16px;
    height: 16px;
    font-size: 14px;
}

.healthcare-nav-item-lg .healthcare-nav-item-icon {
    width: 24px;
    height: 24px;
    font-size: 18px;
}

/* Label */
.healthcare-nav-item-label {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-2, 8px);
    min-width: 0;
}

.healthcare-nav-item-text {
    font-size: var(--font-size-sm, 14px);
    font-weight: var(--font-weight-medium, 500);
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.healthcare-nav-item-lg .healthcare-nav-item-text {
    font-size: var(--font-size-base, 16px);
}

/* Badge */
.healthcare-nav-item-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-full, 9999px);
    font-size: var(--font-size-xs, 12px);
    font-weight: var(--font-weight-semibold, 600);
    line-height: 1;
    flex-shrink: 0;
    transition: all var(--transition-base, 0.3s ease);
}

.healthcare-nav-item-badge-count {
    min-width: 20px;
    height: 20px;
    padding: 0 var(--spacing-2, 8px);
}

.healthcare-nav-item-badge-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.healthcare-nav-item-badge-status {
    padding: var(--spacing-1, 4px) var(--spacing-2, 8px);
    font-size: 10px;
}

.healthcare-nav-item-badge-sm {
    min-width: 16px;
    height: 16px;
    font-size: 10px;
}

/* Badge Colors */
.healthcare-nav-item-badge-primary {
    background: var(--healthcare-primary, #3b82f6);
    color: white;
}

.healthcare-nav-item-badge-success {
    background: var(--healthcare-success, #10b981);
    color: white;
}

.healthcare-nav-item-badge-warning {
    background: var(--healthcare-warning, #f59e0b);
    color: white;
}

.healthcare-nav-item-badge-danger {
    background: var(--healthcare-danger, #ef4444);
    color: white;
}

/* Arrow (for submenu) */
.healthcare-nav-item-arrow {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: var(--text-tertiary, #9ca3af);
    transition: all var(--transition-base, 0.3s ease);
    flex-shrink: 0;
}

.healthcare-nav-item-expanded .healthcare-nav-item-arrow {
    transform: rotate(90deg);
}

/* Active State */
.healthcare-nav-item-active .healthcare-nav-item {
    color: var(--healthcare-primary, #3b82f6);
    background: var(--healthcare-primary-bg, rgba(59, 130, 246, 0.1));
    border-color: var(--healthcare-primary-border, rgba(59, 130, 246, 0.2));
}

.healthcare-nav-item-active .healthcare-nav-item::before {
    opacity: 1;
    background: var(--healthcare-primary-glass, rgba(59, 130, 246, 0.05));
}

.healthcare-nav-item-active .healthcare-nav-item-icon {
    color: var(--healthcare-primary, #3b82f6);
}

/* Active Indicator */
.healthcare-nav-item-indicator {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 24px;
    background: var(--healthcare-primary, #3b82f6);
    border-radius: 0 var(--radius-md, 8px) var(--radius-md, 8px) 0;
    box-shadow: var(--glass-shadow-lg, 0 4px 16px rgba(59, 130, 246, 0.3));
}

/* Disabled State */
.healthcare-nav-item-disabled {
    opacity: 0.5;
    pointer-events: none;
}

.healthcare-nav-item-link-disabled {
    cursor: not-allowed;
}

/* Submenu */
.healthcare-nav-submenu {
    margin-top: var(--spacing-1, 4px);
    margin-left: var(--spacing-8, 32px);
    border-left: 2px solid var(--neutral-200, #e5e7eb);
    padding-left: var(--spacing-4, 16px);
    background: var(--glass-bg, rgba(255, 255, 255, 0.03));
    backdrop-filter: var(--glass-blur, blur(20px));
    border-radius: var(--radius-lg, 12px);
    overflow: hidden;
    transition: all var(--transition-base, 0.3s ease);
}

.healthcare-nav-submenu-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-2, 8px);
    padding: var(--spacing-2, 8px) var(--spacing-3, 12px);
    border-radius: var(--radius-lg, 12px);
    text-decoration: none;
    color: var(--text-tertiary, #9ca3af);
    font-size: var(--font-size-sm, 14px);
    transition: all var(--transition-base, 0.3s ease);
    margin: var(--spacing-1, 4px) 0;
    min-height: 36px;
}

.healthcare-nav-submenu-item:hover {
    color: var(--text-secondary, #6b7280);
    background: var(--glass-bg-hover, rgba(255, 255, 255, 0.1));
}

.healthcare-nav-submenu-item-active {
    color: var(--healthcare-primary, #3b82f6) !important;
    background: var(--healthcare-primary-bg, rgba(59, 130, 246, 0.08));
}

.healthcare-nav-submenu-icon {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
}

.healthcare-nav-submenu-text {
    flex: 1;
    font-weight: var(--font-weight-medium, 500);
}

/* Tooltip */
.healthcare-nav-item-tooltip {
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    margin-left: var(--spacing-2, 8px);
    background: var(--neutral-900, #111827);
    color: white;
    padding: var(--spacing-2, 8px) var(--spacing-3, 12px);
    border-radius: var(--radius-lg, 12px);
    font-size: var(--font-size-xs, 12px);
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-base, 0.3s ease);
    z-index: 1070;
    box-shadow: var(--glass-shadow-xl, 0 20px 48px rgba(0, 0, 0, 0.2));
}

.healthcare-nav-item-tooltip-arrow {
    position: absolute;
    right: 100%;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid var(--neutral-900, #111827);
}

.healthcare-nav-item-container:hover .healthcare-nav-item-tooltip {
    opacity: 1;
    visibility: visible;
}

/* =============================================
   Animation Enhancements
   ============================================= */

.healthcare-nav-item:active {
    transform: translateX(2px) scale(0.98);
}

.healthcare-nav-item-icon {
    animation: none;
}

.healthcare-nav-item:hover .healthcare-nav-item-icon {
    animation: healthcare-nav-icon-bounce 0.6s ease;
}

@keyframes healthcare-nav-icon-bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-3px);
    }
    60% {
        transform: translateY(-1px);
    }
}

/* Submenu Slide Animation */
.healthcare-nav-submenu {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
    margin-top: 0;
}

.healthcare-nav-item-expanded .healthcare-nav-submenu {
    max-height: 300px;
    opacity: 1;
    padding-top: var(--spacing-2, 8px);
    padding-bottom: var(--spacing-2, 8px);
    margin-top: var(--spacing-1, 4px);
}

/* =============================================
   Responsive Design
   ============================================= */

@media (max-width: 768px) {
    .healthcare-nav-item {
        padding: var(--spacing-3, 12px) var(--spacing-2, 8px);
        gap: var(--spacing-2, 8px);
    }
    
    .healthcare-nav-submenu {
        margin-left: var(--spacing-6, 24px);
        padding-left: var(--spacing-3, 12px);
    }
    
    .healthcare-nav-item-tooltip {
        display: none; /* Hide tooltips on mobile */
    }
}

/* =============================================
   Dark Mode Support
   ============================================= */

@media (prefers-color-scheme: dark) {
    .healthcare-nav-item {
        color: var(--neutral-300, #d1d5db);
    }
    
    .healthcare-nav-item::before {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .healthcare-nav-item:hover::before {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .healthcare-nav-item:hover {
        color: var(--neutral-100, #f3f4f6);
    }
    
    .healthcare-nav-submenu {
        border-left-color: var(--neutral-700, #374151);
        background: rgba(17, 24, 39, 0.6);
    }
    
    .healthcare-nav-submenu-item {
        color: var(--neutral-400, #9ca3af);
    }
    
    .healthcare-nav-submenu-item:hover {
        color: var(--neutral-200, #e5e7eb);
        background: rgba(255, 255, 255, 0.05);
    }
}

/* =============================================
   Accessibility Enhancements
   ============================================= */

.healthcare-nav-item:focus-visible {
    outline: 2px solid var(--healthcare-primary, #3b82f6);
    outline-offset: 2px;
}

.healthcare-nav-submenu-item:focus-visible {
    outline: 2px solid var(--healthcare-primary, #3b82f6);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .healthcare-nav-item,
    .healthcare-nav-item::before,
    .healthcare-nav-item-icon,
    .healthcare-nav-item-arrow,
    .healthcare-nav-submenu,
    .healthcare-nav-submenu-item,
    .healthcare-nav-item-tooltip {
        transition: none;
    }
    
    .healthcare-nav-item:hover .healthcare-nav-item-icon {
        animation: none;
    }
    
    .healthcare-nav-item:hover {
        transform: none;
    }
    
    .healthcare-nav-item:active {
        transform: none;
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .healthcare-nav-item {
        border-width: 2px;
    }
    
    .healthcare-nav-item-active .healthcare-nav-item {
        border-width: 3px;
    }
    
    .healthcare-nav-item-indicator {
        width: 6px;
    }
}
</style>

<script>
// Healthcare Navigation Item Component JavaScript
document.addEventListener('DOMContentLoaded', function() {
    initializeHealthcareNavItems();
});

function initializeHealthcareNavItems() {
    // Initialize submenu toggles
    document.querySelectorAll('[data-toggle-submenu]').forEach(toggle => {
        toggle.addEventListener('click', function(e) {
            e.preventDefault();
            
            const container = this.closest('.healthcare-nav-item-container');
            const submenu = container.querySelector('.healthcare-nav-submenu');
            
            if (submenu) {
                toggleSubmenu(container, submenu);
            }
        });
    });
    
    // Initialize keyboard navigation
    document.querySelectorAll('.healthcare-nav-item').forEach(navItem => {
        navItem.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                
                if (this.hasAttribute('data-toggle-submenu')) {
                    const container = this.closest('.healthcare-nav-item-container');
                    const submenu = container.querySelector('.healthcare-nav-submenu');
                    if (submenu) {
                        toggleSubmenu(container, submenu);
                    }
                } else {
                    this.click();
                }
            }
        });
    });
    
    // Auto-collapse other submenus when one is opened
    document.addEventListener('click', function(e) {
        if (e.target.closest('[data-toggle-submenu]')) {
            const clickedContainer = e.target.closest('.healthcare-nav-item-container');
            
            document.querySelectorAll('.healthcare-nav-item-expanded').forEach(expanded => {
                if (expanded !== clickedContainer) {
                    const submenu = expanded.querySelector('.healthcare-nav-submenu');
                    if (submenu) {
                        toggleSubmenu(expanded, submenu, false);
                    }
                }
            });
        }
    });
}

function toggleSubmenu(container, submenu, forceState = null) {
    const isExpanded = container.classList.contains('healthcare-nav-item-expanded');
    const shouldExpand = forceState !== null ? forceState : !isExpanded;
    
    if (shouldExpand) {
        container.classList.add('healthcare-nav-item-expanded');
        submenu.style.display = 'block';
        
        // Animate expansion
        requestAnimationFrame(() => {
            submenu.style.maxHeight = submenu.scrollHeight + 'px';
        });
    } else {
        container.classList.remove('healthcare-nav-item-expanded');
        submenu.style.maxHeight = '0';
        
        // Hide after animation
        setTimeout(() => {
            if (!container.classList.contains('healthcare-nav-item-expanded')) {
                submenu.style.display = 'none';
            }
        }, 300);
    }
    
    // Dispatch custom event
    const event = new CustomEvent('navSubmenuToggle', {
        detail: {
            container: container,
            submenu: submenu,
            expanded: shouldExpand
        }
    });
    container.dispatchEvent(event);
}

function setActiveNavItem(itemSelector) {
    // Remove active state from all items
    document.querySelectorAll('.healthcare-nav-item-container').forEach(container => {
        container.classList.remove('healthcare-nav-item-active');
    });
    
    document.querySelectorAll('.healthcare-nav-submenu-item').forEach(item => {
        item.classList.remove('healthcare-nav-submenu-item-active');
    });
    
    // Set active state for selected item
    const targetItem = document.querySelector(itemSelector);
    if (targetItem) {
        const container = targetItem.closest('.healthcare-nav-item-container');
        if (container) {
            container.classList.add('healthcare-nav-item-active');
        }
        
        if (targetItem.classList.contains('healthcare-nav-submenu-item')) {
            targetItem.classList.add('healthcare-nav-submenu-item-active');
        }
    }
}

// Export utility functions
window.HealthcareNav = {
    toggleSubmenu: toggleSubmenu,
    setActive: setActiveNavItem
};
</script>

<!-- Usage Examples (hidden) -->
<div style="display: none;">
    <!-- Basic Navigation Items -->
    {% include 'components/nav_item.html' with icon="fas fa-home" label="Dashboard" url="/dashboard/" active=True %}
    
    {% include 'components/nav_item.html' with icon="fas fa-users" label="Patients" url="/patients/" badge="12" badge_variant="primary" %}
    
    {% include 'components/nav_item.html' with icon="fas fa-calendar" label="Appointments" url="/appointments/" tooltip="Manage patient appointments" %}
    
    {% include 'components/nav_item.html' with icon="fas fa-chart-line" label="Analytics" url="/analytics/" badge="new" badge_type="status" badge_variant="success" %}
    
    {% include 'components/nav_item.html' with icon="fas fa-bell" label="Notifications" url="/notifications/" badge_type="dot" badge_variant="danger" %}
    
    <!-- Navigation Item with Submenu -->
    {% include 'components/nav_item.html' with 
        icon="fas fa-user-md" 
        label="Clinical" 
        url="/clinical/" 
        submenu=clinical_submenu 
        expanded=False %}
    
    <!-- Disabled Navigation Item -->
    {% include 'components/nav_item.html' with icon="fas fa-cog" label="Settings" url="/settings/" disabled=True tooltip="Coming soon" %}
    
    <!-- JavaScript Usage -->
    <script>
        // Set active navigation item programmatically
        // HealthcareNav.setActive('[data-nav-item="patients"]');
        
        // Listen for submenu toggle events
        // document.addEventListener('navSubmenuToggle', function(e) {
        //     console.log('Submenu toggled:', e.detail);
        // });
    </script>
</div>