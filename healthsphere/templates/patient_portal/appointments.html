{% extends "base.html" %}
{% load static %}

{% block title %}My Appointments - HealthSphere AI{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/bento-grid.css' %}">
<style>
    .gradient-appt {
        background: linear-gradient(135deg, #A8C5E8, #b8d4f0);
    }

    .apt-card {
        padding: 18px;
        background: rgba(168, 197, 232, 0.04);
        border-radius: 14px;
        border-left: 4px solid var(--color-blue);
        margin-bottom: 12px;
        transition: all 0.3s ease;
    }

    .apt-card:hover {
        background: rgba(168, 197, 232, 0.1);
        transform: translateX(4px);
    }

    .apt-card.past {
        opacity: 0.7;
        border-left-color: #d4d4d4;
    }

    .status-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
    }

    .st-scheduled {
        background: rgba(168, 197, 232, 0.15);
        color: #4A90D9;
    }

    .st-confirmed {
        background: rgba(72, 187, 120, 0.1);
        color: #48bb78;
    }

    .st-completed {
        background: rgba(168, 197, 168, 0.15);
        color: #48bb78;
    }

    .st-cancelled {
        background: rgba(232, 155, 135, 0.1);
        color: var(--color-coral);
    }
</style>
{% endblock %}

{% block content %}
<div class="bento-grid">
    <div class="bento-card bento-wide" data-hover-lift>
        <div class="card-glow"></div>
        <div class="card-header">
            <div class="card-title">
                <div class="metric-icon gradient-appt"><i class="fas fa-calendar-alt"></i></div>
                My Appointments
            </div>
            <a href="{% url 'patient_portal:book_appointment' %}" class="bento-btn bento-btn-primary"
                style="background: var(--color-blue); color: white; padding: 8px 16px; border-radius: 10px; text-decoration: none; font-weight: 600;">
                <i class="fas fa-plus"></i> Book New
            </a>
        </div>
    </div>

    <div class="bento-card bento-small" data-hover-lift>
        <div class="card-glow"></div>
        <div class="metric-icon gradient-appt"><i class="fas fa-calendar-check"></i></div>
        <div class="metric-value">{{ upcoming_appointments|length|default:"0" }}</div>
        <div class="metric-label">Upcoming</div>
    </div>

    <div class="bento-card bento-small" data-hover-lift>
        <div class="card-glow"></div>
        <div class="metric-icon" style="background: linear-gradient(135deg, #d4d4d4, #e5e5e5);"><i
                class="fas fa-history"></i></div>
        <div class="metric-value">{{ past_appointments|length|default:"0" }}</div>
        <div class="metric-label">Past</div>
    </div>

    <!-- Upcoming -->
    <div class="bento-card bento-featured" data-tilt>
        <div class="card-glow"></div>
        <div class="card-title"><i class="fas fa-clock"></i> Upcoming Appointments</div>
        <div style="margin-top: 16px;">
            {% for apt in upcoming_appointments %}
            <div class="apt-card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="font-weight: 700; color: #2D3748;">{{ apt.appointment_type|default:"General Visit" }}</div>
                        <div style="font-size: 14px; color: #4A5568; margin-top: 4px;">
                            <i class="fas fa-user-md"></i> Dr. {{ apt.doctor.get_full_name|default:apt.doctor.username
                            }}
                        </div>
                        <div style="font-size: 13px; color: #718096; margin-top: 6px;">
                            <i class="fas fa-calendar"></i> {{ apt.scheduled_date|date:"l, M d, Y" }} &bull;
                            <i class="fas fa-clock"></i> {{ apt.scheduled_time|time:"g:i A" }}
                        </div>
                        {% if apt.notes %}<div style="font-size: 13px; color: #718096; margin-top: 6px;">{{
                            apt.notes|truncatewords:15 }}</div>{% endif %}
                    </div>
                    <span class="status-badge st-{{ apt.status }}">{{ apt.status|capfirst }}</span>
                </div>
            </div>
            {% empty %}
            <div style="text-align: center; padding: 40px; color: #718096;">
                <i class="fas fa-calendar-plus"
                    style="font-size: 48px; opacity: 0.3; margin-bottom: 16px; display: block;"></i>
                <p style="font-weight: 600;">No upcoming appointments</p>
                <a href="{% url 'patient_portal:book_appointment' %}"
                    style="color: var(--color-blue); font-weight: 600; text-decoration: none;">Book one now →</a>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Past -->
    <div class="bento-card bento-tall" data-tilt>
        <div class="card-glow"></div>
        <div class="card-title"><i class="fas fa-history"></i> Past Appointments</div>
        <div style="margin-top: 16px;">
            {% for apt in past_appointments %}
            <div class="apt-card past">
                <div style="font-weight: 600; color: #2D3748;">{{ apt.appointment_type|default:"Visit" }}</div>
                <div style="font-size: 13px; color: #718096; margin-top: 4px;">{{ apt.scheduled_date|date:"M d, Y" }}
                    • Dr. {{ apt.doctor.get_full_name|default:"N/A" }}</div>
                <span class="status-badge st-{{ apt.status }}" style="margin-top: 8px; display: inline-block;">{{ apt.status|capfirst }}</span>
            </div>
            {% empty %}
            <div style="padding: 20px; text-align: center; color: #718096;">No past appointments.</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}